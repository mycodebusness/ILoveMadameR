<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Pour Madame R ❤️</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@700&family=Great+Vibes&display=swap');

        body { 
            margin: 0; 
            overflow: hidden; 
            background-color: #000000;
            font-family: 'Cinzel', serif;
            touch-action: none; /* Empêche le zoom sur mobile */
        }
        
        canvas { display: block; }

        /* --- UI FLOTTANTE (MENU) --- */
        #menu-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 40px;
            height: 40px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            color: white;
            font-size: 20px;
            cursor: pointer;
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(5px);
            transition: 0.3s;
        }
        #menu-btn:hover { background: rgba(255, 255, 255, 0.3); }

        #ui-panel {
            position: absolute;
            top: 70px;
            right: 20px;
            width: 280px;
            background: rgba(20, 0, 10, 0.85);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            padding: 20px;
            border-radius: 15px;
            border: 1px solid rgba(255, 100, 100, 0.3);
            color: #fff;
            transform: translateX(120%); /* Caché par défaut */
            transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            z-index: 99;
            box-shadow: 0 10px 30px rgba(0,0,0,0.8);
        }

        #ui-panel.open { transform: translateX(0); }

        .ui-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 8px; font-size: 0.9rem; color: #ffb7b2; }
        
        input[type="color"] {
            width: 100%; height: 40px; border: none; border-radius: 8px; cursor: pointer;
            background: none;
        }

        .signature {
            font-family: 'Great Vibes', cursive;
            font-size: 1.5rem;
            color: #ff6b81;
            text-align: right;
            margin-top: 10px;
            text-shadow: 0 0 5px rgba(255, 107, 129, 0.5);
        }

        /* --- TEXTE CENTRAL (MADAME R) --- */
        #center-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            pointer-events: none; /* Laisse passer les clics vers la 3D */
            z-index: 10;
            width: 100%;
        }

        .main-name {
            font-family: 'Great Vibes', cursive;
            font-size: 5rem; /* Grand sur mobile */
            background: linear-gradient(to bottom, #fff, #ffd700);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            filter: drop-shadow(0 0 15px rgba(255, 215, 0, 0.6));
            animation: floatText 3s ease-in-out infinite;
            margin: 0;
            line-height: 1;
        }

        .sub-message {
            font-family: 'Cinzel', serif;
            font-size: 1.2rem;
            color: rgba(255, 255, 255, 0.9);
            margin-top: 10px;
            letter-spacing: 2px;
            text-transform: uppercase;
            text-shadow: 0 2px 10px rgba(0,0,0,0.8);
            opacity: 0;
            animation: fadeIn 2s ease-out 1s forwards;
        }

        @keyframes floatText {
            0%, 100% { transform: translateY(0) scale(1); }
            50% { transform: translateY(-10px) scale(1.05); }
        }

        @keyframes fadeIn {
            to { opacity: 1; }
        }

        /* Responsive Mobile */
        @media (max-width: 600px) {
            .main-name { font-size: 3.5rem; }
            .sub-message { font-size: 0.9rem; padding: 0 20px; }
            #ui-panel { width: 85%; right: 7.5%; }
        }
    </style>
    
    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
            }
        }
    </script>
</head>
<body>

    <!-- Bouton Menu -->
    <div id="menu-btn" onclick="toggleMenu()">⚙️</div>

    <!-- Panneau de Contrôle -->
    <div id="ui-panel">
        <div class="ui-group">
            <label>Couleur de l'Amour</label>
            <input type="color" id="colorPicker" value="#ff3366">
        </div>
        <div class="ui-group">
            <label>Vitesse du Cœur</label>
            <input type="range" id="speedSlider" min="0.5" max="3" step="0.1" value="1.5">
        </div>
        <div class="signature">Mr le Sage</div>
    </div>

    <!-- Contenu Central (HTML superposé à la 3D) -->
    <div id="center-content">
        <h1 class="main-name">Madame R</h1>
        <div class="sub-message">Je t'aime de tout mon être</div>
    </div>

    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
        import { EffectComposer } from 'three/addons/postprocessing/EffectComposer.js';
        import { RenderPass } from 'three/addons/postprocessing/RenderPass.js';
        import { UnrealBloomPass } from 'three/addons/postprocessing/UnrealBloomPass.js';

        // --- 1. SCÈNE & CAMÉRA ---
        const scene = new THREE.Scene();
        scene.fog = new THREE.FogExp2(0x050005, 0.03);

        const camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 0.1, 100);
        camera.position.z = 22;

        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2)); // Optimisation mobile
        document.body.appendChild(renderer.domElement);

        const controls = new OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;
        controls.dampingFactor = 0.05;
        controls.enableZoom = false; // On garde le zoom fixe pour l'effet cinéma
        controls.autoRotate = true;
        controls.autoRotateSpeed = 0.5;

        // --- 2. LE CŒUR DE PARTICULES ---
        const particlesGeometry = new THREE.BufferGeometry();
        const particlesCount = 5000;
        
        const posArray = new Float32Array(particlesCount * 3);
        const colorsArray = new Float32Array(particlesCount * 3);
        const sizesArray = new Float32Array(particlesCount);
        const randomnessArray = new Float32Array(particlesCount * 3); // Pour l'animation

        const colorObj = new THREE.Color();

        for(let i = 0; i < particlesCount; i++) {
            // Formule du cœur (Corrigée pour pointer vers le bas)
            // x = 16sin^3(t)
            // y = -(13cos(t) - 5cos(2t) - 2cos(3t) - cos(4t))  <-- Le moins devant 13 inverse le Y
            
            const t = Math.random() * Math.PI * 2;
            const u = Math.random() * Math.PI; // Épaisseur
            
            // Coordonnées de surface
            const hx = 16 * Math.pow(Math.sin(t), 3);
            const hy = -(13 * Math.cos(t) - 5 * Math.cos(2*t) - 2 * Math.cos(3*t) - Math.cos(4*t));
            
            // Ajout du volume (intérieur du cœur)
            const volumeFactor = Math.pow(Math.random(), 0.5); // Concentre plus de points vers le centre
            const thickness = 3.5;

            const x = hx * volumeFactor + (Math.random() - 0.5) * 0.5;
            const y = hy * volumeFactor + (Math.random() - 0.5) * 0.5;
            const z = (Math.random() - 0.5) * thickness * volumeFactor;

            posArray[i * 3] = x;
            posArray[i * 3 + 1] = y;
            posArray[i * 3 + 2] = z;

            // Couleurs (Dégradé Rouge -> Or -> Blanc)
            const rand = Math.random();
            if(rand > 0.9) colorObj.setHex(0xffffff); // Étincelles blanches
            else if(rand > 0.7) colorObj.setHex(0xffd700); // Or
            else colorObj.setHex(0xff0040); // Rouge profond

            colorsArray[i * 3] = colorObj.r;
            colorsArray[i * 3 + 1] = colorObj.g;
            colorsArray[i * 3 + 2] = colorObj.b;

            sizesArray[i] = Math.random() * 0.4;

            // Données pour l'animation de flottement
            randomnessArray[i*3] = (Math.random() - 0.5) * 2;
            randomnessArray[i*3+1] = (Math.random() - 0.5) * 2;
            randomnessArray[i*3+2] = (Math.random() - 0.5) * 2;
        }

        particlesGeometry.setAttribute('position', new THREE.BufferAttribute(posArray, 3));
        particlesGeometry.setAttribute('color', new THREE.BufferAttribute(colorsArray, 3));
        particlesGeometry.setAttribute('size', new THREE.BufferAttribute(sizesArray, 1));
        particlesGeometry.setAttribute('aRandom', new THREE.BufferAttribute(randomnessArray, 3));

        // Shader personnalisé pour un effet de lueur douce
        const particlesMaterial = new THREE.PointsMaterial({
            size: 0.35,
            vertexColors: true,
            blending: THREE.AdditiveBlending,
            depthWrite: false,
            transparent: true,
            opacity: 0.8,
            sizeAttenuation: true
        });

        const heartSystem = new THREE.Points(particlesGeometry, particlesMaterial);
        scene.add(heartSystem);

        // --- 3. ÉTOILES EN ARRIÈRE PLAN ---
        const starsGeo = new THREE.BufferGeometry();
        const starsCount = 1500;
        const starsPos = new Float32Array(starsCount * 3);
        for(let i=0; i<starsCount*3; i++) {
            starsPos[i] = (Math.random() - 0.5) * 80;
        }
        starsGeo.setAttribute('position', new THREE.BufferAttribute(starsPos, 3));
        const starsMat = new THREE.PointsMaterial({color: 0x888888, size: 0.15, transparent: true, opacity: 0.6});
        const stars = new THREE.Points(starsGeo, starsMat);
        scene.add(stars);

        // --- 4. POST-PROCESSING (BLOOM) ---
        const renderScene = new RenderPass(scene, camera);
        const bloomPass = new UnrealBloomPass(new THREE.Vector2(window.innerWidth, window.innerHeight), 1.5, 0.4, 0.85);
        bloomPass.threshold = 0.1;
        bloomPass.strength = 1.5; // Lueur intense
        bloomPass.radius = 0.6;

        const composer = new EffectComposer(renderer);
        composer.addPass(renderScene);
        composer.addPass(bloomPass);

        // --- 5. ANIMATION ---
        const clock = new THREE.Clock();
        let beatSpeed = 1.5;

        function animate() {
            requestAnimationFrame(animate);
            const elapsedTime = clock.getElapsedTime();

            // Battement de cœur (Formule "Lub-Dub")
            const t = elapsedTime * beatSpeed;
            const beat = Math.pow(Math.sin(t), 60) * 0.15; 
            const beat2 = Math.pow(Math.sin(t + Math.PI), 60) * 0.08;
            const scale = 1 + beat + beat2;

            heartSystem.scale.set(scale, scale, scale);
            
            // Rotation lente du cœur entier
            heartSystem.rotation.y = Math.sin(elapsedTime * 0.2) * 0.1;
            heartSystem.rotation.z = Math.cos(elapsedTime * 0.15) * 0.05;

            // Animation des particules (vibration interne)
            const positions = particlesGeometry.attributes.position.array;
            const randoms = particlesGeometry.attributes.aRandom.array;
            
            for(let i=0; i < particlesCount; i++) {
                // Mouvement sinusoïdal basé sur le temps et la position aléatoire
                positions[i*3] += Math.sin(elapsedTime * 2 + randoms[i*3]) * 0.005;
                positions[i*3+1] += Math.cos(elapsedTime * 2 + randoms[i*3+1]) * 0.005;
                positions[i*3+2] += Math.sin(elapsedTime * 2 + randoms[i*3+2]) * 0.005;
            }
            particlesGeometry.attributes.position.needsUpdate = true;

            // Mouvement des étoiles (parallaxe)
            stars.rotation.y = elapsedTime * 0.02;

            controls.update();
            composer.render();
        }

        animate();

        // --- 6. GESTION UI & INTERACTION ---

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
            composer.setSize(window.innerWidth, window.innerHeight);
        });

        // Toggle Menu
        window.toggleMenu = function() {
            const panel = document.getElementById('ui-panel');
            const btn = document.getElementById('menu-btn');
            panel.classList.toggle('open');
            btn.style.transform = panel.classList.contains('open') ? 'rotate(90deg)' : 'rotate(0deg)';
        }

        // Changement de couleur
        const colorPicker = document.getElementById('colorPicker');
        colorPicker.addEventListener('input', (e) => {
            const newColor = new THREE.Color(e.target.value);
            const colors = particlesGeometry.attributes.color.array;
            
            for(let i=0; i < particlesCount; i++) {
                const rand = Math.random();
                if(rand > 0.9) {
                    colors[i*3] = 1; colors[i*3+1] = 1; colors[i*3+2] = 1;
                } else if (rand > 0.7) {
                    // Garde un peu d'or
                    colors[i*3] = 1; colors[i*3+1] = 0.84; colors[i*3+2] = 0; 
                } else {
                    colors[i*3] = newColor.r;
                    colors[i*3+1] = newColor.g;
                    colors[i*3+2] = newColor.b;
                }
            }
            particlesGeometry.attributes.color.needsUpdate = true;
        });

        // Vitesse
        const speedSlider = document.getElementById('speedSlider');
        speedSlider.addEventListener('input', (e) => {
            beatSpeed = parseFloat(e.target.value);
        });

    </script>
</body>
</html>